# BotHATTwaffle
### Description
The [Source Engine Discord server](https://discord.gg/SourceEngine)'s overlord. Features include:

* Playtest event retrieval and announcement using Google's Calendar API.
* Server reservation and interaction over RCON.
* Retrieval of demo files from servers over FTP.
* Interactive embed builder.
* Searching of the [Valve Developer Community](https://developer.valvesoftware.com) and
[TopHATTwaffle's tutorials](https://www.tophattwaffle.com/tutorials/).
* Automatic generation of embeds for Steam Workshop links.
* Mutes and other basic administrative functions.
* Shitposts

Currently, the bot isn't designed to be user-friendly. If you're not a developer or at least willing to get your hands a bit
dirty, you probably wont manage to get much use out of the bot. Furthermore, **the bot is designed to only be connected to a
single server.**

### Configuration
> **Note** All configuration files are expect to be located in the same directory as the application's DLL.

* `settings.ini` contains most settings. If it does not exist, it will be created with default values. However, some properties
will still need to be configured manually.
* `client_secret.json` is generated by Google and required for access to Google's Calendar API.
* Configuration of servers and search data can currently only be done through direct modification of the database. An example
is provided in `/res/Master.sql`.
* `BotHATTwaffle.dll.config` or `App.config` store the connection string for the database. In most cases, there shouldn't be a
need to change this.
* Discord Role IDs are hard-coded in an enumeration in `BotHATTwaffle.Models.Roles`. They must be changed if the bot is to run
on any server other than the Source Engine Discord server.
* The bot expects certain Discord channels to be present in the server to which it is connected. See `settings.ini` for
specifics.

### Requirements
* [.NET Core 2.1 Runtime](https://www.microsoft.com/net/download/dotnet-core/2.1)
    * Not required for a self-contained deployment. However, .NET Core's native dependencies will still be required.

#### Development
* [.NET Core 2.1 SDK](https://www.microsoft.com/net/download/dotnet-core/2.1)
* [Visual Studio 2017 15.7](https://visualstudio.microsoft.com/downloads/) or newer.
    * [JetBrains Rider](https://www.jetbrains.com/rider/) should, in theory, also work. However, it is untested.
* `OPTIONAL` [EF Core Tools](https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/index)
    * Only useful for scaffolding and managing migrations. Starting with .NET Core 2.1, these tools are already included.

### Deployment
If you wish to run the bot outside its build directory or even on another machine, you need to run the
[`dotnet publish`](https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-publish) command. Here's a basic
example for a [framework-dependent deployment](https://docs.microsoft.com/en-us/dotnet/core/deploying/index):

```bash
dotnet publish ./BotHATTwaffle/BotHATTwaffle.csproj -c Release -o /some/output/dir/
```

### Running
Run the following command:

```bash
dotnet BotHATTwaffle.dll
```

### Development Notes
If you wish to build without Google Calendar, modify `BotHATTwaffle.Services.Playtesting.EventCalendarService`. Remove the code
related to authentication and have `GetEvents()` only return the default values for the array.

Read about [migrations](https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations/index) to get a basic understanding
of working with Entity Framework Core.
